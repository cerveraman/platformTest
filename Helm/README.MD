# Deploy Jenkins as a service with Helm
* The goal of the exercise is to deploy a Jenkins running instance using the Helm chart located in https://github.com/guipal/jenkins-helm in a local Kubernetes cluster provided with Docker-desktop.
## Prerequisites
* The local machine must have Docker desktop installed with Kubernetes option enabled and Helm must also be installed.
## Create a namespace
* In order to isolate the project from other projects and deployments a new namespace jenkins has been created with the following command:
```sh
$ kubectl create namespace jenkins
```
### Create a persistent volume
* To prevent losing the whole configuration of the Jenkins controller and jobs when Docker desktop is rebooted a persistent volume will be deployed using the /data directory. This directory will contain the Jenkins controller configuration. The configuration file for this persistent volume named jenkins-pv is in the file jenkins-volume.yaml
```sh
$ kubectl apply -f jenkins-volume.yaml
```
### Create a persistent volume claim
* The pods created by Helm chart will need to claim resources from the persistent volume, thus a persistent volume claim needs to be deployed. The configuration file for this persistent volume claim named jenkins-pvc is in the file jenkins-pvc.yaml
```sh
$ kubectl apply -f jenkins-pvc.yaml
```
### Create a Service Account, a Cluster Role and a Cluster Role Binding
* To run jenkins in Kubernetes the Service Account jenkins will be created. This service account needs to have some specific permissions within the namespace jenkins, specified by the Cluster Role jenkins. The two are linked by the deployment of the Cluster Role Binding jenkins. The configuration file for these three elements is in the file jenkins-sa.yaml
### Install Jenkins
* The default values of the Helm chart provided in http://github.com/guipal/jenkins-helm must be modified to include all the previous deployments. The following values must be modified in the values.yaml file provided in that repository:
```sh
persistence:
  enabled: true
  ## A manually managed Persistent Volume and Claim
  ## Requires persistence.enabled: true
  ## If defined, PVC must be created manually before volume will be bound
  existingClaim:
  ## jenkins data Persistent Volume Storage Class
  ## If defined, storageClassName: <storageClass>
  ## If set to "-", storageClassName: "", which disables dynamic provisioning
  ## If undefined (the default) or set to null, no storageClassName spec is
  ##   set, choosing the default provisioner.  (gp2 on AWS, standard on
  ##   GKE, AWS & OpenStack)
  ##
  storageClass: jenkins-pv
  annotations: {}
  accessMode: "ReadWriteOnce"
  size: "8Gi"
  volumes:
  #  - name: nothing
  #    emptyDir: {}
  mounts:
  #  - mountPath: /var/nothing
  #    name: nothing
  #    readOnly: true

serviceAccount:
  create: false
  # The name of the service account is autogenerated by default
  name: jenkins
  annotations: {}
  imagePullSecretName:

```
* The new values file is saved as jenkins-values.yaml
* After applying all these steps jenkins can be installed:
```sh
$ helm install jenkins -n jenkins -f jenkins-values.yaml jenkins/jenkins
```